<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Manage Special Requests</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles_requests_manage.css') }}">
</head>
<body>
    <header>
        <a href="/" class="logo">Manage Special Requests</a>
        <div class="auth-buttons">
            <a class="btn-backdash" href="{{ url_for('admin_dashboard') }}">Back to Admin Dashboard</a>
        </div>
    </header>

    <div class="container">
        <!-- Flash messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <ul class="flashes">
                    {% for category, message in messages %}
                        <li class="{{ category }}">{{ message }}</li>
                    {% endfor %}
                </ul>
            {% endif %}
        {% endwith %}

        {% for request in requests %}
        <div class="card">
            <div class="card-header">
                <h3>Customer Name: {{ request.customer_name }}</h3>
                <h4><strong>Phone:</strong> {{ request.customer_phone }}</h4>
            </div>
            <div class="card-body">
                <p><strong>Requested At:</strong> {{ request.time_ordered }}</p>
                
                <form action="{{ url_for('edit_request_time', request_id=request.id) }}" method="POST" class="inline-edit-form">
                    <p><strong>Requested At:</strong> {{ request.time_ordered }}</p>
                    <input type="date" name="request_date" value="{{ request.request_date }}" required>
                    <button type="submit" class="btn-update">Update</button>
                </form>
                
                <p><strong>Special Request:</strong></p>
                <p>{{ request.special_request | replace('\n', '<br>') | safe }}</p>
                
                <p class="status"><strong>Status:</strong>
                    {% if request.approved %}
                        ‚úÖ Approved
                        {% if request.time_approved %}
                            on {{ request.time_approved }}
                        {% endif %}
                        {% if request.time_delivered %}
                            <br>üì¶ Delivered on {{ request.time_delivered }}
                        {% else %}
                            <br>üöö Not yet delivered
                        {% endif %}
                    {% elif request.rejected %}
                        ‚ùå Rejected
                        {% if request.time_rejected %}
                            on {{ request.time_rejected }}
                        {% endif %}
                    {% else %}
                        ‚è≥ Not yet reviewed
                    {% endif %}
                </p>
            </div>

            <div class="card-footer actions">
                <a href="{{ url_for('approve_request', request_id=request.id) }}" class="btn-approve">Approve</a>
                <a href="{{ url_for('reject_request', request_id=request.id) }}" class="btn-reject">Reject</a>
                <a href="{{ url_for('edit_request_time', request_id=request.id) }}" class="btn-edit">Edit Date/Time</a>
                
                <form action="{{ url_for('mark_special_request_delivered', request_id=request.id) }}" method="POST" style="display: inline;">
                    <button type="submit" class="btn-deliver">Mark as Delivered</button>
                </form>
            </div>
        </div>
        {% endfor %}
    </div>
</body>
</html>
